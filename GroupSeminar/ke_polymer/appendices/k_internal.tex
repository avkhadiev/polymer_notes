%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%					 	            INTERNAL KINETIC ENERGY CALCULATION					           %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Subsection names and labels
\section{Internal Kinetic Energy Calculation}
\label{app:k-internal}
%-------------------------------------------------------------------------------
% Add text directly into the main file, or use \input statements
%-------------------------------------------------------------------------------
\par We start with the expression of for the velocity of the $i$th atom in the molecule relative to $\vcm$:
\begin{equation*}
\begin{aligned}
  \vel_{i} - \vcm
    &= \left(\vel_{0} + \bondlength \sum_{j=1}^{i}\bigcdot\bondvel_{j} \right)
      - \left( \vcmtargetrep \right) \\
    &= \bondlength \sum_{j=1}^{i} \bondvel_{j}
      - \frac{\bondlength}{N+1} \sum_{j=1}^{N}
        \left(N+1-j\right)\bondvel_{j}
\end{aligned}
\end{equation*}
\par Squaring the expression and summing over all the atoms gives:
\begin{equation*}
\begin{aligned}
  \sum_{i = 0}^{N}
    \left(
      \vel_{i} - \vcm
    \right)^2
    &= \bondlength^2 \sum_{i = 0}^{N}
      \left(
        \left( \sum_{j = 1}^{i} \bondvel_{j} \right)^2
        + \left(\frac{1}{N+1}\right)^2 B_{jk} \bondvel^{j}\bigcdot\bondvel^{k}
        - \frac{2}{N+1}
            \left(A_{j}\bondvel^{j}\right)
            \left(\sum_{k=1}^{i} \bondvel_{k} \right)
      \right)
\end{aligned}
\end{equation*}
Where $A_{j} = (N + 1 - j)$ and $B_{jk} = (N + 1 - i) (N + 1 - j)$.
\par The first term in the expression, when summed over $N+1$ items, gives
\begin{equation*}
\begin{aligned}
  \bondlength^2 \sum_{i = 0}^{N} \left( \sum_{j = 1}^{i} \bondvel_{j} \right)^2
    &= \sum_{i = 0}^{N}
      \bondlength^2 \left(
         \sum_{j = 1}^{i} \bondvel_{j}
      \right)
      \left(
         \sum_{k = 1}^{i} \bondvel_{k}
      \right) \\
    &= \bondlength^2 \sum_{j = 1}^{N} \sum_{k = 1}^{N}
      \left(
        N + 1 - \max (j,\,k)
      \right) \bondvel_{j}\bigcdot\bondvel_{k}
\end{aligned}
\end{equation*}
\par The second term in the expression above does not have free indices, so summing over $N+1$ atoms simply gives $N+1$ identical terms.
\par Summing the third term in the expression above, we obtain
\begin{equation*}
\begin{aligned}
  - \bondlength^2 \frac{2}{N+1} \sum_{i = 0}^{N}
    \left(
      A_{j}\bondvel^{j}
    \right)
    \left(
      \sum_{k=1}^{i}
      \bondvel_{k}
    \right)
    &= -\bondlength^2 \frac{2}{N+1}
      \sum_{j = 1}^{N} \sum_{k = 1}^{N}
      (N + 1 - j) (N + 1 - k) \bondvel_{j}\bigcdot\bondvel_{k}  \\
    &= -\bondlength^2 \frac{2}{N+1} B_{jk} \bondvel^{j}\bigcdot\bondvel^{k}
\end{aligned}
\end{equation*}
%-------------------------------------------------------------------------------
\par Combining the three terms, we obtain:
\begin{equation*}
\begin{aligned}
  \sum_{i = 0}^{N}
    \left(
      \vel_{i} - \vcm
    \right)^2
    &= \bondlength^2
        \sum_{j = 1}^{N} \sum_{k = 1}^{N}
        \left(
        \left(
          N + 1 - \max (j,\,k)
        \right) \bondvel_{j}\bigcdot\bondvel_{k}
        + \frac{1}{N+1} B_{jk} \bondvel^{j}\bigcdot\bondvel^{k}
        - \frac{2}{N+1} B_{jk} \bondvel^{j}\bigcdot\bondvel^{k}
      \right) \\
    &= \bondlength^2 \sum_{j = 1}^{N} \sum_{k = 1}^{N}
      \left(
          \left(
            N + 1 - \max (j,\,k) - \frac{(N+1-j)(N+1-k)}{N+1}
          \right)
          \bondvel^{j}\bigcdot\bondvel^{k}
      \right) \\
    &= \frac{\bondlength^2}{N+1}   \sum_{j = 1}^{N} \sum_{k = 1}^{N}
      \left(
        \left(\min (j,\,k)(N+1)-jk\right)
        \bondvel_{j}\bigcdot\bondvel_{k}
      \right) \\
    &= \bondlength^2
      \left(
        C_{jk} \bondvel^{j}\bigcdot\bondvel^{k}
      \right)
\end{aligned}
\end{equation*}
Where we defined a matrix $C_{jk}$:
\begin{tcolorbox}
\begin{equation*}
\label{eq:matrix-ke-int}
  C_{jk} = \frac{\min (j,\,k)(N+1)-jk}{N+1}
\end{equation*}
\end{tcolorbox}
This yields an expression for the internal kinetic energy of the system:
\begin{tcolorbox}
\begin{equation*}
    K_{\mathrm{internal}}
      = \onehalf m\bondlength^2 C_{jk} \bondvel^{j}\bigcdot\bondvel^{k}
\end{equation*}
\end{tcolorbox}
